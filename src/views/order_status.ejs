<h3>Tr·∫°ng th√°i ƒë∆°n #<%= order.orderCode %></h3>

<% if (ok) { %>
<div class="alert alert-info">
  C·∫£m ∆°n b·∫°n! H·ªá th·ªëng ƒëang x√°c nh·∫≠n thanh to√°n (qua webhook). Trang s·∫Ω t·ª± c·∫≠p
  nh·∫≠t.
</div>
<% } else { %>
<div class="alert alert-warning">
  B·∫°n ƒë√£ h·ªßy thanh to√°n. B·∫°n c√≥ th·ªÉ th·ª≠ l·∫°i.
</div>
<% } %>

<p>
  <strong>Tr·∫°ng th√°i hi·ªán t·∫°i:</strong>
  <span
    class="badge bg-<%= order.status === 'PAID' ? 'success' : 'secondary' %>"
    ><%= order.status %></span
  >
</p>

<% if (order.status === 'PAID') { %>
<div class="mb-4">
  <div class="card shadow-sm border-success">
    <div class="card-header bg-success text-white">
      <h4 class="mb-0">üì¶ H∆∞·ªõng d·∫´n k√≠ch ho·∫°t code</h4>
    </div>
    <div class="card-body">
      <p class="mb-3">
        ƒê·ªÉ t√¥n tr·ªçng quy·ªÅn t√°c gi·∫£ (aka: ng∆∞·ªùi vi·∫øt code), vui l√≤ng th·ª±c hi·ªán
        c√°c b∆∞·ªõc sau:
      </p>
      <ol class="list-group list-group-numbered">
        <li class="list-group-item">
          Sao ch√©p <strong class="text-primary">m√£ ƒë∆°n</strong> c·ªßa b·∫°n:
          <code>#<%= order.orderCode %></code>
        </li>
        <li class="list-group-item">
          Sau khi t·∫£i code v√† import CSDL, h·ªá th·ªëng s·∫Ω y√™u c·∫ßu
          <strong>m√£ k√≠ch ho·∫°t</strong>. H√£y nh·∫≠p m√£ ƒë∆°n c·ªßa b·∫°n.
          <span class="badge bg-warning text-dark ms-2"
            >M·ªói m√£ k√≠ch ho·∫°t ch·ªâ d√πng 1 l·∫ßn</span
          >
        </li>
        <li class="list-group-item">
          Sau khi k√≠ch ho·∫°t, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng code ngay.
          <br />
          <small class="text-muted">
            ‚ö†Ô∏è Code ƒë∆∞·ª£c kh√≥a theo IP/m√°y. Vui l√≤ng kh√¥ng chia s·∫ª sau khi k√≠ch
            ho·∫°t.
          </small>
        </li>
        <li class="list-group-item">
          Trong tr∆∞·ªùng h·ª£p ƒë√£ thanh to√°n m√† key l·ªói nh·∫Øn m√¨nh nha
          <strong class="text-danger">Zalo: 0335010817</strong> hoaÃ£ÃÜc
          <strong class="text-danger">Tele: @devcatphim</strong>
        </li>
      </ol>
    </div>
  </div>
</div>

<div
  class="alert alert-success d-flex align-items-center justify-content-between"
>
  <div>‚úÖ Thanh to√°n th√†nh c√¥ng! B·∫°n c√≥ th·ªÉ t·∫£i code t·∫°i ƒë√¢y:</div>
  <a
    class="btn btn-sm btn-primary ms-2"
    href="<%= order.code.driveLink %>"
    target="_blank"
    rel="noopener"
  >
    M·ªü link Drive
  </a>
</div>
<% } else { %>
<button id="reload" class="btn btn-outline-primary btn-sm">
  Ki·ªÉm tra l·∫°i tr·∫°ng th√°i
</button>
<script>
  const btn = document.getElementById('reload');
  btn.addEventListener('click', async () => {
    const res = await fetch('/api/order/<%= order._id %>');
    const data = await res.json();
    if (data.status === 'PAID') location.reload();
    else alert('Ch∆∞a nh·∫≠n ƒë∆∞·ª£c thanh to√°n, th·ª≠ l·∫°i sau.');
  });
  // auto-poll m·ªói 4s
  setInterval(async () => {
    const res = await fetch('/api/order/<%= order._id %>');
    const data = await res.json();
    if (data.status === 'PAID') location.reload();
  }, 4000);
</script>
<% } %>
